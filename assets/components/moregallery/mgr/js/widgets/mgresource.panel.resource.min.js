moreGallery.panel.Resource=function(e){moreGallery.panel.Resource.superclass.constructor.call(this,e);moreGallery.ResourceRecord=e.record};Ext.extend(moreGallery.panel.Resource,MODx.panel.Resource,{defaultClassKey:"mgResource",classLexiconKey:"moregallery.name",getFields:function(e){var t=moreGallery.panel.Resource.superclass.getFields.call(this,e),n=moreGallery.getResourceProperty(e.record,"content_position",moreGallery.config.content_position);if(n=="tab"){var r=t.filter(function(e){return e.id=="modx-resource-tabs"?e:!1});r[0].items.splice(1,0,{title:_("resource_content"),id:"modx-resource-content-tab",cls:"modx-resource-tab",layout:"form",labelAlign:"top",labelSeparator:"",bodyCssClass:"tab-panel-wrapper main-wrapper",autoHeight:!0,items:[{xtype:"panel",layout:"form",anchor:"98%",border:!1,autoHeight:!0,id:"modx-resource-content",items:[MODx.panel.Resource.prototype.getContentField(e)]}]})}var i=MODx.panel.Resource.prototype.getContentField(e);i&&Ext.each(t,function(t,n,r){if(t.id=="modx-resource-content"){r[n]=this.getContentField(e);return!1}},this);return t},getPageHeader:function(){return{html:"<h2>"+_("moregallery.new")+"</h2>",id:"modx-resource-header",cls:"modx-page-header",border:!1,forceLayout:!0,anchor:"100%"}},getContentField:function(e){var t=this.getResourceContentField(e),n={xtype:"modx-panel",id:"moregallery-content",items:[],border:!1,defaults:{}};e.mode=="update"?n.items.push([{xtype:"modx-panel",title:_("moregallery.name"),id:"mgresource-backbone-wrapper",html:'<div id="mgresource-backbone"></div>',bodyCssClass:"main-wrapper",collapsible:!0,animCollapse:!1}]):n.items.push([{xtype:"modx-panel",title:_("moregallery.name"),id:"mgresource-backbone-wrapper",html:"<p>"+_("moregallery.please_save_first")+"</p>",bodyCssClass:"main-wrapper",collapsible:!0,animCollapse:!1}]);var r=moreGallery.getResourceProperty(e.record,"content_position",moreGallery.config.content_position);switch(r){case"above":return[t,n];case"below":return[n,t]}return[n]},getResourceContentField:function(e){return{title:_("resource_content"),id:"modx-resource-content",layout:"form",bodyCssClass:"main-wrapper",autoHeight:!0,collapsible:!0,animCollapse:!1,hideMode:"offsets",items:MODx.panel.Resource.prototype.getContentField(e),style:"margin-top: 10px"}},getSettingLeftFields:function(e){var t=MODx.panel.Resource.prototype.getSettingLeftFields(e);moreGallery.config.permissions.resource_settings&&t.push({xtype:"contentblocks-combo-source",fieldLabel:_("moregallery.source"),description:_("moregallery.source.desc"),name:"properties_source",hiddenName:"properties_source",id:"moregallery-source",anchor:"100%",value:moreGallery.getResourceProperty(e.record,"source","inherit")},{xtype:"textfield",fieldLabel:_("moregallery.relative_url"),description:_("moregallery.relative_url.desc"),name:"properties_relative_url",hiddenName:"properties_relative_url",id:"moregallery-relative_url",anchor:"100%",value:moreGallery.getResourceProperty(e.record,"relative_url","inherit")},{xtype:"moregallery-combo-contentlocation",fieldLabel:_("moregallery.content_position"),description:_("moregallery.content_position.desc"),name:"properties_content_position",hiddenName:"properties_content_position",id:"moregallery-content_position",anchor:"100%",value:moreGallery.getResourceProperty(e.record,"content_position","inherit")},{xtype:"textfield",fieldLabel:_("setting_moregallery.crops"),description:_("setting_moregallery.crops_desc"),name:"properties_crops",hiddenName:"properties_crops",id:"moregallery-crops",anchor:"100%",value:moreGallery.getResourceProperty(e.record,"crops","inherit")},{xtype:"textfield",fieldLabel:_("setting_moregallery.custom_fields"),description:_("setting_moregallery.custom_fields_desc"),name:"properties_custom_fields",hiddenName:"properties_custom_fields",id:"moregallery-custom_fields",anchor:"100%",value:moreGallery.getResourceProperty(e.record,"custom_fields","inherit")});return t},success:function(e){moreGallery.panel.Resource.superclass.success.call(this,e);var t=e.result.object;this.config.record&&this.config.record.properties&&this.config.record.properties.moregallery&&this.config.record.properties.moregallery.content_position!==t.properties_content_position&&(location.href=location.href);this.config.record&&this.config.record.properties&&this.config.record.properties.moregallery&&this.config.record.properties.moregallery.crops!==t.properties_crops&&(location.href=location.href);this.config.record&&this.config.record.properties&&this.config.record.properties.moregallery&&this.config.record.properties.moregallery.custom_fields!==t.properties_custom_fields&&(location.href=location.href)}});Ext.reg("modx-panel-resource",moreGallery.panel.Resource);