!function(a,b){b.fieldTypes.video=function(c,d){var e={apiInserted:!1,apiLoaded:!1};return e.init=function(){d.value&&this.selectVideo(d.value),d.video_id&&this.selectVideo(d.video_id),c.find(".contentblocks-field-delete-video").on("click",function(a){a.preventDefault(),c.find(".video_id").val(""),c.find(".contentblocks-field-video-preview").empty(),c.removeClass("hasVideo"),b.fireChange()}),c.find(".contentblocks-field-video-link").on("change",function(){var c=a(this).val(),d=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,f=c.match(d);f&&11==f[2].length&&(a(this).val(""),e.selectVideo(f[2]),b.fireChange())}).on("keyup",function(){var b=a(this);setTimeout(function(){b.trigger("change")},100)}),c.find(".contentblocks-field-video-choose").on("click",function(a){a.preventDefault();var c=tmpl("contentblocks-modal-video",{});b.openModal("Choose Video",c,{initCallback:function(a,b){a.addClass("contentblocks-modal-video");var c=a.find(".contentblocks-modal-content").css("maxHeight").slice(0,-2);c-=85,a.find(".contentblocks-modal-scrollable-area").css("maxHeight",c+"px");var d=a.find("form"),f=d.find(".query");e.resultsHolder=a.find(".youtube-search-results"),e.moreBtn=a.find(".contentblocks-search-results-more"),e.moreBtn.hide(),d.on("submit",function(a){a.preventDefault();var b=f.val();e.loadResults(b,!0)}),e.moreBtn.on("click",function(){var a=f.val(),b=e.moreBtn.data("token");e.loadResults(a,!1,b)})}})})},e.loadResults=function(c,d,f){a.ajax({url:"https://www.googleapis.com/youtube/v3/search",data:{q:c,part:"id,snippet",maxResults:12,type:"video",videoEmbeddable:!0,key:"AIzaSyB0dw388ateBJGR-wIGxPTWtJUmDx55gKw",pageToken:f||""}}).done(function(c,f,g){var h=[];a.each(c.items,function(a,b){b.snippet.publishedAt=new Date(b.snippet.publishedAt).format(MODx.config.manager_date_format),h.push(tmpl("contentblocks-field-video-item",b))}),h=h.join(""),d?e.resultsHolder.html(h):e.resultsHolder.append(h),e.resultsHolder.find("li").on("click",function(){var c=a(this).data("video_id");""!=c&&(e.selectVideo(c),b.closeModal(),b.fireChange())}),c.nextPageToken?e.moreBtn.data("token",c.nextPageToken).show():e.moreBtn.data("token","").hide()}).fail(function(a,b,c){var d=_("contentblocks.video.api_error",{message:a.responseJSON.error.message,code:a.responseJSON.error.code});e.resultsHolder.html('<p class="error">'+d+"</p>"),e.moreBtn.hide()})},e.selectVideo=function(a){c.addClass("hasVideo"),c.find(".video_id").val(a);var b=c.find(".contentblocks-field-video-preview");b.html('<iframe class="youtube-player" src="https://www.youtube.com/embed/'+a+'?rel=0" frameborder="0">')},e.getData=function(){return{value:c.find(".video_id").val()}},e}}(vcJquery,ContentBlocks);
//# sourceMappingURL=video-min.js.map